<!DOCTYPE html>
<!-- Agent Keys Management Tab -->
<section x-show="currentTab === 'agent-keys'" class="section-modern animate-fade-in">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
        <div>
            <h2 class="text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent mb-2">Agent Keys Management</h2>
            <p class="text-gray-600">Generate keys and manage agents</p>
        </div>
        <div class="flex space-x-2">
            <button @click="openAgentKeyModal()" class="btn-primary">
                <i class="fas fa-plus mr-2"></i>Generate New Key
            </button>
        </div>
    </div>
    
    
    <!-- Card wrapper for the table -->
    <div class="card-modern">
        <!-- Table view -->
        <!-- Server-side table controls -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4 p-4 sm:p-6">
            <div class="flex items-center gap-2 text-sm">
                <span class="text-gray-600">Show</span>
                <select class="input-modern py-1 px-2 w-24"
                        @change="setAgentTablePageSize($event)"
                        x-init="$nextTick(()=>{ refreshAgentsTable() })">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
                <span class="text-gray-600">entries</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                    <input type="text" class="input-modern py-1 pl-8" placeholder="Search..."
                           @input="setAgentTableSearch($event)">
                </div>
            </div>
        </div>

        <div class="overflow-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-50 text-gray-700">
                    <tr>
                        <th class="px-4 py-3 text-left font-semibold w-16">No</th>
                        <th class="px-4 py-3 text-left font-semibold">Name</th>
                        <th class="px-4 py-3 text-left font-semibold">IP Address</th>
                        <th class="px-4 py-3 text-left font-semibold">Port</th>
                        <th class="px-4 py-3 text-left font-semibold">Status</th>
                        <th class="px-4 py-3 text-left font-semibold">Capabilities</th>
                        <th class="px-4 py-3 text-left font-semibold">Agent Key</th>
                        <th class="px-4 py-3 text-left font-semibold">Last Seen</th>
                        <th class="px-4 py-3 text-left font-semibold">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    <template x-for="(item, idx) in agents" :key="item.id">
                        <tr class="hover:bg-gray-50/60">
                            <td class="px-4 py-3 text-gray-700" x-text="((agentTable.page||1)-1)*parseInt(agentTable.pageSize||10) + idx + 1"></td>
                            <td class="px-4 py-3 font-medium text-gray-900" x-text="item.name"></td>
                            <td class="px-4 py-3 text-gray-700" x-text="item.ip_address || '-' "></td>
                            <td class="px-4 py-3 text-gray-700" x-text="item.port ?? '-' "></td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 rounded-full text-xs"
                                      :class="item.status === 'online' ? 'bg-green-100 text-green-700' : item.status === 'busy' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'"
                                      x-text="item.status"></span>
                            </td>
                            <td class="px-4 py-3 text-gray-700" x-text="item.capabilities || '-' "></td>
                            <td class="px-4 py-3">
                                <div class="flex items-center gap-2">
                                    <span class="font-mono text-xs text-gray-800" x-text="item.agent_key"></span>
                                    <button class="btn-secondary px-2 py-1 text-xs" @click="copyAgentKey(item.agent_key)">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-gray-700" x-text="formatDate(item.last_seen)"></td>
                            <td class="px-4 py-3">
                                <button class="btn-danger px-2 py-1 text-xs" @click="deleteAgent(item.id)">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            </td>
                        </tr>
                    </template>
                    <tr x-show="agents.length === 0">
                        <td colspan="9" class="px-4 py-10 text-center text-gray-500">
                            No agents yet. Click "Generate New Key" to create one.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="flex items-center justify-between mt-4 text-sm p-4 sm:p-6">
            <div class="text-gray-600">
                <span x-text="(() => { const page=agentTable.page||1; const size=parseInt(agentTable.pageSize||10); const total=(agentTable.total||agentStore.getState().pagination?.total||0); const start = total===0 ? 0 : (page-1)*size+1; const end = Math.min(page*size, total); return `Showing ${start} to ${end} of ${total} entries` })()"></span>
            </div>
            <div class="flex items-center gap-2">
                <button class="px-3 py-1 rounded-md border text-gray-600 hover:bg-gray-50"
                        :class="(agentTable.page||1) === 1 ? 'opacity-50 cursor-not-allowed bg-gray-200' : ''"
                        :disabled="(agentTable.page||1) === 1"
                        @click="goPrevAgentsPage()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <!-- numbered pages -->
                <template x-for="p in Math.max(1, Math.ceil((agentTable.total||0)/(agentTable.pageSize||10)))" :key="p">
                    <button class="px-3 py-1 rounded-md border"
                            :class="(agentTable.page===p) ? 'bg-blue-50 border-blue-400 text-blue-600' : 'text-gray-700 hover:bg-gray-50'"
                            @click="goToAgentsPage(p)" x-text="p"></button>
                </template>
                <button class="px-3 py-1 rounded-md border text-gray-600 hover:bg-gray-50"
                        :class="(() => { const page=agentTable.page||1; const size=parseInt(agentTable.pageSize||10); const total=agentTable.total||0; return page*size>=total ? 'opacity-50 cursor-not-allowed bg-gray-200' : '' })()"
                        :disabled="(() => { const page=agentTable.page||1; const size=parseInt(agentTable.pageSize||10); const total=agentTable.total||0; return page*size>=total })()"
                        @click="goNextAgentsPage()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</section>